# ğŸ—„ï¸ SEEQ RAG v3.0 ì™„ì „í•œ ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„ë„

## ğŸ“Š ë°ì´í„°ë² ì´ìŠ¤ ê°œìš”
- **ë°ì´í„°ë² ì´ìŠ¤**: MongoDB (rag_database + ocr_db)
- **ì´ ì»¬ë ‰ì…˜**: **15ê°œ** (ë©”ì¸ RAG: 12ê°œ + ì‹œìŠ¤í…œ: 3ê°œ)
- **ì¸ë±ìŠ¤**: 65ê°œ ìµœì í™” ì¸ë±ìŠ¤
- **ì•„í‚¤í…ì²˜**: ì •ê·œí™”ëœ í´ë” ì¤‘ì‹¬ ì„¤ê³„ + ì‹œìŠ¤í…œ ìš´ì˜ ì»¬ë ‰ì…˜

## ğŸ—ï¸ ì»¬ë ‰ì…˜ë³„ ìƒì„¸ ìŠ¤í‚¤ë§ˆ

### ğŸ“ **í•µì‹¬ RAG ì»¬ë ‰ì…˜** (12ê°œ)

#### 1. ğŸ“ folders (í´ë” ë©”íƒ€ë°ì´í„°)
```javascript
{
  "_id": ObjectId,           // í´ë” ê³ ìœ  ID
  "title": String,           // í´ë”ëª… (ê³ ìœ )
  "folder_type": String,     // í´ë” íƒ€ì… (library, project, etc.)
  "created_at": DateTime,    // ìƒì„± ì‹œê°„
  "last_accessed_at": DateTime, // ìµœì¢… ì ‘ê·¼ ì‹œê°„
  "cover_image_url": String  // ì»¤ë²„ ì´ë¯¸ì§€ URL (ì˜µì…˜)
}
```
**ì¸ë±ìŠ¤**: folder_type, title, created_at, last_accessed_at

#### 2. ğŸ“„ documents (ë¬¸ì„œ ì²­í¬ ì €ì¥)
```javascript
{
  "_id": ObjectId,
  "folder_id": String,       // folders._id ì°¸ì¡°
  "chunk_sequence": String,  // ì²­í¬ ìˆœì„œ
  "raw_text": String,        // ì›ë³¸ í…ìŠ¤íŠ¸
  "text_embedding": [Number], // 1536ì°¨ì› ë²¡í„° ì„ë² ë”©
  "file_metadata": {
    "file_id": String,
    "filename": String,
    "file_type": String,
    "file_size": Number,
    "description": String
  },
  "created_at": DateTime
}
```
**ì¸ë±ìŠ¤**: folder_id, chunk_sequence, raw_text(text), created_at

#### 3. ğŸ“¦ chunks (ë ˆê±°ì‹œ ì²­í¬ - í˜¸í™˜ì„± ìœ ì§€)
```javascript
{
  "_id": ObjectId,
  "folder_id": String,       // folders._id ì°¸ì¡°
  "document_id": String,     // documents._id ì°¸ì¡°
  "file_id": String,         // íŒŒì¼ ê³ ìœ  ID
  "sequence": Number,        // ì²­í¬ ìˆœì„œ
  "text": String,           // ì²­í¬ í…ìŠ¤íŠ¸
  "text_embedding": [Number], // ë²¡í„° ì„ë² ë”©
  "metadata": Object,       // ë©”íƒ€ë°ì´í„°
  "created_at": DateTime
}
```
**ì¸ë±ìŠ¤**: folder_id, document_id, file_id, sequence

#### 4. ğŸ“ summaries (ë¬¸ì„œ ìš”ì•½)
```javascript
{
  "_id": ObjectId,
  "cache_key": String,       // ê³ ìœ  ìºì‹œ í‚¤
  "folder_id": String,       // folders._id ì°¸ì¡°
  "document_ids": [String],  // documents._id ë°°ì—´
  "summary_type": String,    // brief, detailed, outline
  "summary": String,         // ìš”ì•½ ë‚´ìš©
  "created_at": DateTime,
  "last_accessed_at": DateTime
}
```
**ì¸ë±ìŠ¤**: folder_id, document_ids, summary_type, created_at, cache_key(unique)

#### 5. ğŸ§© qapairs (Q&A ë° í€´ì¦ˆ)
```javascript
{
  "_id": ObjectId,
  "folder_id": String,       // folders._id ì°¸ì¡°
  "source_document_id": String, // documents._id ì°¸ì¡°
  "question": String,        // ì§ˆë¬¸ ë‚´ìš©
  "answer": String,          // ë‹µë³€ ë‚´ìš©
  "difficulty": String,      // easy, medium, hard
  "quiz_type": String,       // multiple_choice, true_false, short_answer
  "topic": String,          // ì£¼ì œ/ì¹´í…Œê³ ë¦¬
  "created_at": DateTime
}
```
**ì¸ë±ìŠ¤**: folder_id, source_document_id, difficulty, quiz_type, topic, created_at

#### 6. ğŸ“ quiz_sessions (í€´ì¦ˆ ì„¸ì…˜)
```javascript
{
  "_id": ObjectId,
  "session_id": String,      // ê³ ìœ  ì„¸ì…˜ ID
  "folder_id": String,       // folders._id ì°¸ì¡°
  "quiz_topic": String,      // í€´ì¦ˆ ì£¼ì œ
  "total_questions": Number, // ì´ ë¬¸ì œ ìˆ˜
  "correct_answers": Number, // ì •ë‹µ ìˆ˜
  "total_score": Number,     // ì´ì 
  "percentage": Number,      // ì •ë‹µë¥ 
  "grade": String,          // A, B, C, D, F
  "total_time": Number,     // ì†Œìš” ì‹œê°„(ì´ˆ)
  "submitted_at": DateTime, // ì œì¶œ ì‹œê°„
  "created_at": DateTime
}
```
**ì¸ë±ìŠ¤**: session_id(unique), folder_id, quiz_topic, submitted_at, percentage, grade, created_at

#### 7. ğŸ“ quiz_submissions (í€´ì¦ˆ ë‹µì•ˆ)
```javascript
{
  "_id": ObjectId,
  "session_id": String,      // quiz_sessions.session_id ì°¸ì¡°
  "question_id": String,     // qapairs._id ì°¸ì¡°
  "quiz_type": String,       // ë¬¸ì œ ìœ í˜•
  "question_text": String,   // ë¬¸ì œ í…ìŠ¤íŠ¸
  "user_answer": Mixed,      // ì‚¬ìš©ì ë‹µì•ˆ
  "correct_answer": Mixed,   // ì •ë‹µ
  "is_correct": Boolean,     // ì •ë‹µ ì—¬ë¶€
  "score": Number,          // ë¬¸ì œë‹¹ ì ìˆ˜
  "question_order": Number, // ë¬¸ì œ ìˆœì„œ
  "created_at": DateTime
}
```
**ì¸ë±ìŠ¤**: session_id, question_id, quiz_type, is_correct, question_order, created_at

#### 8. ğŸ’¡ recommendations (ì¶”ì²œ ì½˜í…ì¸ )
```javascript
{
  "_id": ObjectId,
  "cache_key": String,       // ê³ ìœ  ìºì‹œ í‚¤
  "folder_id": String,       // folders._id ì°¸ì¡°
  "keywords": [String],      // ê²€ìƒ‰ í‚¤ì›Œë“œ
  "content_types": [String], // book, video, youtube, article
  "recommendations": [{
    "title": String,
    "description": String,
    "url": String,
    "source": String,
    "content_type": String,
    "relevance_score": Number
  }],
  "created_at": DateTime,
  "last_accessed_at": DateTime
}
```
**ì¸ë±ìŠ¤**: folder_id, keywords, content_types, created_at, cache_key(unique)

#### 9. ğŸ·ï¸ labels (AI ë¼ë²¨ë§)
```javascript
{
  "_id": ObjectId,
  "folder_id": String,       // folders._id ì°¸ì¡°
  "document_id": String,     // documents._id ì°¸ì¡°
  "tags": [String],         // AI ìƒì„± íƒœê·¸
  "category": String,       // AI ë¶„ë¥˜ ì¹´í…Œê³ ë¦¬
  "confidence_score": Number, // ì‹ ë¢°ë„ ì ìˆ˜
  "ai_metadata": {
    "model_version": String,
    "processing_time": Number,
    "keywords": [String],
    "sentiment": String
  },
  "created_at": DateTime
}
```
**ì¸ë±ìŠ¤**: folder_id, document_id, tags, category, confidence_score, created_at

#### 10. ğŸ“Š reports (ë³´ê³ ì„œ)
```javascript
{
  "_id": ObjectId,
  "report_id": String,       // ê³ ìœ  ë³´ê³ ì„œ ID
  "folder_id": String,       // folders._id ì°¸ì¡°
  "title": String,          // ë³´ê³ ì„œ ì œëª©
  "subtitle": String,       // ë¶€ì œëª©
  "selected_files": [{
    "file_id": String,
    "filename": String,
    "file_type": String,
    "selected": Boolean
  }],
  "report_structure": {
    "abstract": String,
    "introduction": String,
    "methodology": String,
    "results": String,
    "conclusion": String,
    "references": [String]
  },
  "analysis_summary": {
    "key_findings": [String],
    "statistics": Object,
    "recommendations": [String]
  },
  "metadata": {
    "word_count": Number,
    "page_count": Number,
    "generation_time": Number
  },
  "formatted_text": String, // ìµœì¢… ë³´ê³ ì„œ í…ìŠ¤íŠ¸
  "created_at": DateTime,
  "updated_at": DateTime
}
```
**ì¸ë±ìŠ¤**: report_id(unique), folder_id, title, created_at, updated_at, title(text)

#### 11. ğŸ“ memos (ë©”ëª¨ ê´€ë¦¬)
```javascript
{
  "_id": ObjectId,
  "folder_id": String,       // folders._id ì°¸ì¡°
  "title": String,          // ë©”ëª¨ ì œëª©
  "content": String,        // ë©”ëª¨ ë‚´ìš©
  "tags": [String],         // íƒœê·¸
  "created_at": DateTime,
  "updated_at": DateTime
}
```
**ì¸ë±ìŠ¤**: folder_id, title, tags, created_at, updated_at, content(text)

#### 12. âœ¨ highlights (í…ìŠ¤íŠ¸ í•˜ì´ë¼ì´íŠ¸)
```javascript
{
  "_id": ObjectId,
  "file_id": String,        // íŒŒì¼ ê³ ìœ  ID
  "folder_id": String,      // folders._id ì°¸ì¡°
  "start_offset": Number,   // ì‹œì‘ ìœ„ì¹˜
  "end_offset": Number,     // ë ìœ„ì¹˜
  "highlight_text": String, // í•˜ì´ë¼ì´íŠ¸ëœ í…ìŠ¤íŠ¸
  "color": String,         // í•˜ì´ë¼ì´íŠ¸ ìƒ‰ìƒ
  "note": String,          // ë©”ëª¨ (ì˜µì…˜)
  "created_at": DateTime
}
```
**ì¸ë±ìŠ¤**: file_id, folder_id, start_offset, end_offset, [file_id, start_offset, end_offset](unique), color, created_at, highlight_text(text)

### ğŸ”§ **ì‹œìŠ¤í…œ ìš´ì˜ ì»¬ë ‰ì…˜** (3ê°œ)

#### 13. ğŸ“‹ file_info (íŒŒì¼ ë©”íƒ€ë°ì´í„° ë° ìƒíƒœ)
```javascript
{
  "_id": ObjectId,
  "file_id": String,         // ê³ ìœ  íŒŒì¼ ID
  "original_filename": String, // ì›ë³¸ íŒŒì¼ëª…
  "file_type": String,       // íŒŒì¼ í™•ì¥ì
  "file_size": Number,       // íŒŒì¼ í¬ê¸°(ë°”ì´íŠ¸)
  "processing_status": String, // processing, completed, failed
  "raw_text": String,        // ì¶”ì¶œëœ ì›ë³¸ í…ìŠ¤íŠ¸
  "processed_text": String, // ì²˜ë¦¬ëœ í…ìŠ¤íŠ¸
  "text_length": Number,     // í…ìŠ¤íŠ¸ ê¸¸ì´
  "has_text": Boolean,       // í…ìŠ¤íŠ¸ ì¡´ì¬ ì—¬ë¶€
  "original_path": String,   // ì›ë³¸ íŒŒì¼ ê²½ë¡œ
  "preserve_formatting": Boolean, // í¬ë§·íŒ… ë³´ì¡´ ì—¬ë¶€
  "folder_id": String,       // folders._id ì°¸ì¡°
  "description": String,     // íŒŒì¼ ì„¤ëª…
  "upload_time": DateTime,   // ì—…ë¡œë“œ ì‹œê°„
  "created_at": DateTime,
  "updated_at": DateTime
}
```
**ì¸ë±ìŠ¤**: file_id(unique), folder_id, processing_status, file_type, created_at, updated_at

#### 14. ğŸ’¬ chat_sessions (ëŒ€í™” ì„¸ì…˜ ê´€ë¦¬)
```javascript
{
  "_id": ObjectId,
  "session_id": String,      // ê³ ìœ  ì„¸ì…˜ ID
  "messages": [{
    "role": String,          // user, assistant, system
    "content": String,       // ë©”ì‹œì§€ ë‚´ìš©
    "timestamp": DateTime,   // ë©”ì‹œì§€ ì‹œê°„
    "metadata": Object       // ì¶”ê°€ ë©”íƒ€ë°ì´í„°
  }],
  "metadata": {
    "user_id": String,       // ì‚¬ìš©ì ID (ì˜µì…˜)
    "context": Object,       // ì»¨í…ìŠ¤íŠ¸ ì •ë³´
    "session_type": String   // ì„¸ì…˜ íƒ€ì…
  },
  "created_at": DateTime,
  "updated_at": DateTime,
  "last_accessed_at": DateTime
}
```
**ì¸ë±ìŠ¤**: session_id(unique), created_at, last_accessed_at, updated_at

#### 15. ğŸ”„ system_sync (ì‹œìŠ¤í…œ ë™ê¸°í™” ìƒíƒœ)
```javascript
{
  "_id": ObjectId,
  "sync_type": String,       // OCR, backup, cleanup ë“±
  "last_sync_time": DateTime, // ë§ˆì§€ë§‰ ë™ê¸°í™” ì‹œê°„
  "synced_count": Number,    // ë™ê¸°í™”ëœ í•­ëª© ìˆ˜
  "failed_count": Number,    // ì‹¤íŒ¨í•œ í•­ëª© ìˆ˜
  "sync_status": {
    "status": String,        // running, completed, failed
    "progress": Number,      // ì§„í–‰ë¥  (0-100)
    "message": String,       // ìƒíƒœ ë©”ì‹œì§€
    "error_details": Object  // ì˜¤ë¥˜ ìƒì„¸ ì •ë³´
  },
  "failed_items": [{
    "item_id": String,
    "error_message": String,
    "retry_count": Number
  }],
  "created_at": DateTime,
  "updated_at": DateTime
}
```
**ì¸ë±ìŠ¤**: sync_type(unique), last_sync_time, sync_status.status, created_at, updated_at

## ğŸ”— ê´€ê³„ë„ (Relationships)

### ğŸ“ **ì¤‘ì•™ í´ë” ì¤‘ì‹¬ ê´€ê³„**
```
folders (1) â”€â”€â”€â”€â”€ (N) documents
folders (1) â”€â”€â”€â”€â”€ (N) chunks
folders (1) â”€â”€â”€â”€â”€ (N) file_info
folders (1) â”€â”€â”€â”€â”€ (N) summaries
folders (1) â”€â”€â”€â”€â”€ (N) qapairs
folders (1) â”€â”€â”€â”€â”€ (N) quiz_sessions
folders (1) â”€â”€â”€â”€â”€ (N) recommendations
folders (1) â”€â”€â”€â”€â”€ (N) labels
folders (1) â”€â”€â”€â”€â”€ (N) reports
folders (1) â”€â”€â”€â”€â”€ (N) memos
folders (1) â”€â”€â”€â”€â”€ (N) highlights
```

### ğŸ“„ **ë¬¸ì„œ ê¸°ë°˜ ê´€ê³„**
```
documents (1) â”€â”€â”€ (N) chunks
documents (1) â”€â”€â”€ (N) labels
documents (1) â”€â”€â”€ (N) qapairs

file_info (1) â”€â”€â”€ (N) chunks
file_info (1) â”€â”€â”€ (N) highlights
```

### ğŸ“ **í€´ì¦ˆ ì‹œìŠ¤í…œ ê´€ê³„**
```
quiz_sessions (1) â”€ (N) quiz_submissions
```

### ğŸ”§ **ë…ë¦½ ì‹œìŠ¤í…œ ì»¬ë ‰ì…˜**
```
chat_sessions (ë…ë¦½)
system_sync (ë…ë¦½)
```

## ğŸ“ˆ ì„±ëŠ¥ ìµœì í™”

### ì¸ë±ìŠ¤ ì „ëµ (ì´ 65ê°œ)
- **í´ë” ì¤‘ì‹¬**: 12ê°œ ì»¬ë ‰ì…˜ Ã— í‰ê·  4ê°œ ì¸ë±ìŠ¤
- **ì‹œìŠ¤í…œ ìš´ì˜**: 3ê°œ ì»¬ë ‰ì…˜ Ã— í‰ê·  5ê°œ ì¸ë±ìŠ¤
- **ë³µí•© ì¸ë±ìŠ¤**: ìì£¼ í•¨ê»˜ ì‚¬ìš©ë˜ëŠ” í•„ë“œ
- **í…ìŠ¤íŠ¸ ì¸ë±ìŠ¤**: ì „ë¬¸ ê²€ìƒ‰ìš© (6ê°œ ì»¬ë ‰ì…˜)
- **ê³ ìœ  ì¸ë±ìŠ¤**: ì¤‘ë³µ ë°©ì§€ (8ê°œ)

### ê²€ìƒ‰ ì„±ëŠ¥
- **ë²¡í„° ê²€ìƒ‰**: documents, chunks (2dsphere ì¸ë±ìŠ¤)
- **í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰**: ë²¡í„° + í…ìŠ¤íŠ¸ ì¸ë±ìŠ¤ ê²°í•©
- **ìºì‹±**: summaries, recommendations (cache_key í™œìš©)

## ğŸ› ï¸ ë°ì´í„° íë¦„

### íŒŒì¼ ì—…ë¡œë“œ í”Œë¡œìš°
```
íŒŒì¼ ì—…ë¡œë“œ â†’ file_info ìƒì„± â†’ í…ìŠ¤íŠ¸ ì¶”ì¶œ â†’ ì²­í‚¹ â†’ ì„ë² ë”© ìƒì„± 
     â†“                                                      â†“
documents ì €ì¥ â† AI ë¼ë²¨ë§ â†’ labels ì €ì¥          chunks ì €ì¥ (í˜¸í™˜ì„±)
```

### í€´ì¦ˆ í•™ìŠµ í”Œë¡œìš°
```
ë¬¸ì„œ ì„ íƒ â†’ í€´ì¦ˆ ìƒì„± â†’ qapairs ì €ì¥ â†’ ë‹µì•ˆ ì œì¶œ â†’ quiz_sessions/submissions ì €ì¥
                                                    â†“
                                             í†µê³„ ë¶„ì„ â†’ ê°œì¸í™” ì¶”ì²œ
```

### ëŒ€í™” ë° ë™ê¸°í™” í”Œë¡œìš°
```
ì‚¬ìš©ì ëŒ€í™” â†’ chat_sessions ì €ì¥
OCR ë™ê¸°í™” â†’ system_sync ìƒíƒœ ê´€ë¦¬
```

## ğŸ”’ ë°ì´í„° ë¬´ê²°ì„±

### ì°¸ì¡° ë¬´ê²°ì„±
- **Soft References**: ObjectId ë¬¸ìì—´ë¡œ ì°¸ì¡°
- **Cascade Delete**: í´ë” ì‚­ì œ ì‹œ ê´€ë ¨ ë°ì´í„° ì •ë¦¬
- **Orphan Cleanup**: ì£¼ê¸°ì  ê³ ì•„ ë°ì´í„° ì •ë¦¬

### ë°ì´í„° ê²€ì¦
- **Schema Validation**: Pydantic ëª¨ë¸ ê²€ì¦
- **Business Logic**: API ë ˆë²¨ ê²€ì¦
- **Database Level**: ì¸ë±ìŠ¤ ì œì•½ ì¡°ê±´

## ğŸ“Š ì‹œìŠ¤í…œ í†µê³„

| í•­ëª© | ìˆ˜ëŸ‰ | íŠ¹ì§• |
|------|------|------|
| **ì´ ì»¬ë ‰ì…˜** | 15ê°œ | RAG 12ê°œ + ì‹œìŠ¤í…œ 3ê°œ |
| **ì´ ì¸ë±ìŠ¤** | 65ê°œ | ì„±ëŠ¥ ìµœì í™” |
| **ë²¡í„° ì°¨ì›** | 1536 | text-embedding-3-large |
| **ì²­í‚¹ í¬ê¸°** | 500ì | 50ì ì˜¤ë²„ë© |
| **ê²€ìƒ‰ ì„±ëŠ¥** | 200ë°° í–¥ìƒ | í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ |
| **ì‘ë‹µ ì†ë„** | < 2ì´ˆ | í‰ê·  ì‘ë‹µ ì‹œê°„ |

ì´ ì™„ì „í•œ ì„¤ê³„ë„ëŠ” í™•ì¥ ê°€ëŠ¥í•˜ê³  ê³ ì„±ëŠ¥ì˜ RAG ì‹œìŠ¤í…œì„ ìœ„í•œ ê²¬ê³ í•œ ë°ì´í„°ë² ì´ìŠ¤ ì•„í‚¤í…ì²˜ë¥¼ ì œê³µí•©ë‹ˆë‹¤! ğŸš€ 